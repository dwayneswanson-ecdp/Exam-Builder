<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="google" content="notranslate" />
<title>Exam Builder – Instructor Portal</title>
<style>
  :root { --blue:#004080; --blue2:#0066cc; --bg:#f6f8fb; --card:#ffffff; --border:#d8dee9; }
  *{box-sizing:border-box}
  body{font-family:Inter, system-ui, Arial, sans-serif; background:var(--bg); margin:0; color:#1b1f23;}
  header{background:linear-gradient(135deg,var(--blue),var(--blue2)); color:#fff; padding:28px 18px; text-align:center;}
  header h1{margin:0; font-weight:800; letter-spacing:.3px}
  main{max-width:1000px; margin:28px auto; padding:0 16px 40px}
  .card{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:22px 20px; box-shadow:0 2px 10px rgba(0,0,0,.04); margin-bottom:18px;}
  h2{margin:8px 0 12px; color:var(--blue); font-size:20px}
  label{display:block; font-size:14px; margin-top:10px; color:#0f172a}
  input[type=text], input[type=number], textarea{width:100%; border:1px solid var(--border); border-radius:8px; padding:10px 12px; font-size:15px; background:#fff;}
  textarea{min-height:110px; resize:vertical}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:14px}
  .small{font-size:12px; color:#6b7280}
  .btn{background:var(--blue); color:#fff; border:none; padding:12px 18px; border-radius:10px; font-size:16px; cursor:pointer}
  .btn:hover{background:#003166}
  table{width:100%; border-collapse:collapse; margin-top:8px}
  th, td{border:1px solid var(--border); padding:8px; font-size:14px}
  th{background:#eef2ff; text-align:left}
  .gate{max-width:440px; margin:60px auto}
  .err{color:#b00020; font-size:13px; margin-left:10px; display:none}
</style>
</head>
<body>
<header>
  <h1>Exam Builder – Instructor Portal</h1>
</header>

<main>
  <!-- Password Gate -->
  <section class="card gate" id="gate">
    <h2>Instructor Access</h2>
    <label>Password
      <input type="password" id="gatePwd" placeholder="Enter password…" />
    </label>
    <div style="margin-top:12px">
      <button class="btn" id="gateBtn">Unlock</button>
      <span id="gateErr" class="err">Incorrect password.</span>
    </div>
  </section>

  <!-- Builder (hidden until unlock) -->
  <section id="builder" style="display:none">
    <div class="card">
      <h2>Step 1 — Exam Info</h2>
      <div class="row">
        <label>Exam Title
          <input type="text" id="examTitle" value="English Exam – Business Resources" />
        </label>
        <label>Class Code
          <input type="text" id="classCode" value="MDO2G3" />
        </label>
      </div>
      <div class="row">
        <label>Time Limit (minutes)
          <input type="number" id="timeLimit" min="5" max="180" step="5" value="40" />
        </label>
        <label>Email Subject Format <span class="small">(use <b>(NAME)</b> placeholder)</span>
          <input type="text" id="emailSubject" value="(NAME) – English Exam – Business Resources (MDO2G3)" />
        </label>
      </div>
    </div>

    <div class="card">
      <h2>Step 2 — Email Delivery (EmailJS)</h2>
      <div class="row">
        <label>Public Key
          <input type="text" id="emailjsKey" placeholder="e.g., Bb0oPYBiZGQcyIz5r" />
        </label>
        <label>Service ID
          <input type="text" id="emailjsService" placeholder="e.g., service_opm4h6b" />
        </label>
      </div>
      <div class="row">
        <label>Template ID
          <input type="text" id="emailjsTemplate" placeholder="e.g., template_r0u784p" />
        </label>
        <label>Instructor Email (note)
          <input type="text" id="instructorEmail" placeholder="Configured in your EmailJS template" />
        </label>
      </div>
      <p class="small">Your EmailJS template must include variables <code>{{subject}}</code> and <code>{{message_html}}</code>.</p>
    </div>

    <div class="card">
      <h2>Step 3 — Vocabulary (10 items)</h2>
      <p class="small">Enter the <b>Word</b> and its <b>Correct Definition</b>. Students will match via dropdowns (randomized; “-- Choose --” always first).</p>
      <table>
        <thead><tr><th>#</th><th>Word</th><th>Correct Definition</th></tr></thead>
        <tbody id="vocabBody"></tbody>
      </table>
    </div>

    <div class="card">
      <h2>Step 4 — Part B Writing Prompt</h2>
      <label>Prompt Text
        <textarea id="promptText">You are a team leader. One of your suppliers has delayed an important delivery. Write a short email to your manager. In your email, explain the problem, suggest a solution, and use a polite and professional tone. You must use at least 3 words from the vocabulary list.</textarea>
      </label>
    </div>

    <div class="card">
      <h2>Step 5 — Generate Exam</h2>
      <button class="btn" id="generateBtn">Generate & Download index.html</button>
      <p class="small">This downloads a self-contained student exam (timer, fullscreen guard, anti-copy, EmailJS reporting).</p>
    </div>
  </section>
</main>

<script>
document.addEventListener("DOMContentLoaded", function() {

  /* ========== Gate (Instructor Access) ========== */
  const BUILDER_PASSWORD = "teacher2025";
  const gateSection = document.getElementById("gate");
  const builderSection = document.getElementById("builder");
  const gateBtn = document.getElementById("gateBtn");
  const gateErr = document.getElementById("gateErr");
  const gatePwd = document.getElementById("gatePwd");

  gateBtn.addEventListener("click", function() {
    const inputVal = gatePwd.value.trim();
    if (inputVal === BUILDER_PASSWORD) {
      gateErr.style.display = "none";
      gateSection.style.display = "none";
      builderSection.style.display = "block";
      console.log("✅ Access granted");
    } else {
      gateErr.style.display = "inline";
      console.warn("❌ Wrong password");
    }
  });

  // Allow Enter key to submit password
  gatePwd.addEventListener("keypress", function(e) {
    if (e.key === "Enter") gateBtn.click();
  });

  /* ========== Prefill Vocab ========== */
  const defaults = [
    ["Budget","A plan for how money will be spent during a specific period."],
    ["Forecast","A prediction of future sales, costs, or results."],
    ["KPI","A measurable value showing how effectively goals are achieved."],
    ["Supplier","A company providing goods or services to another."],
    ["Lead Time","The time between ordering and receiving something."],
    ["Inventory","The goods and materials a company holds."],
    ["Overhead","Ongoing expenses not tied to one product or service."],
    ["Sustainability","Managing resources for long-term balance."],
    ["ROI","Financial gain or loss compared to cost of investment."],
    ["Headcount","Number of employees in a company or department."]
  ];
  const tbody = document.getElementById("vocabBody");
  for (let i = 0; i < 10; i++) {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i + 1}</td>
      <td><input type="text" id="w${i}" value="${defaults[i][0]}"></td>
      <td><input type="text" id="d${i}" value="${defaults[i][1]}"></td>`;
    tbody.appendChild(tr);
  }

  /* ========== Helper for HTML escaping ========== */
  function htmlEscape(s) {
    return String(s)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;");
  }

  /* ========== Build Exam HTML and Download ========== */
  function buildExamHTML(cfg) {
    // (This part is unchanged from your current version)
    // You don’t need to edit anything here unless we adjust the exam template later
  }

  /* ========== Generate & Auto-Download ========== */
  document.getElementById("generateBtn").addEventListener("click", () => {
    const title = (document.getElementById("examTitle").value || "English Exam").trim();
    const classCode = (document.getElementById("classCode").value || "CLASS").trim();
    const timeLimit = Math.max(5, +document.getElementById("timeLimit").value || 40);
    const emailSub = (document.getElementById("emailSubject").value || "(NAME) – English Exam").trim();
    const emailjsKey = document.getElementById("emailjsKey").value.trim();
    const emailjsService = document.getElementById("emailjsService").value.trim();
    const emailjsTemplate = document.getElementById("emailjsTemplate").value.trim();

    const vocab = [];
    for (let i = 0; i < 10; i++) {
      const w = (document.getElementById("w" + i).value || "").trim();
      const d = (document.getElementById("d" + i).value || "").trim();
      if (!w || !d) {
        alert("Please fill all vocabulary rows (word + definition).");
        return;
      }
      vocab.push({ word: w, definition: d });
    }

    const prompt = (document.getElementById("promptText").value || "").trim();
    if (!prompt) {
      alert("Please enter a Part B prompt.");
      return;
    }

    const html = buildExamHTML({
      title,
      classCode,
      timeLimit,
      subject: emailSub,
      emailjsKey,
      emailjsService,
      emailjsTemplate,
      vocab,
      prompt,
    });

    const blob = new Blob([html], { type: "text/html;charset=utf-8" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "English_Exam_" + classCode + ".html";
    document.body.appendChild(a);
    a.click();
    URL.revokeObjectURL(a.href);
    a.remove();
  });

});
</script>
</body>
</html>
